

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CORE-V CV32A6-step1 Design Specification documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #DDDDDD" >
          

          
            <a href="index.html#document-index" class="icon icon-home"> CORE-V CV32A6-step1 Design Specification
          

          
            
            <img src="_static/openhw-landscape.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
            
              <!-- Local TOC -->
              <div class="local-toc"><p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-intro">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#license">License</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#standards-compliance">Standards Compliance</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#documentation-framework">Documentation framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#contributors">Contributors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-system">CV32A6-step1 System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#functionality">Functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#architecture">Architecture</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-frontend">FRONTEND Sub-System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#functionality">Functionality</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#pc-generation-stage">PC Generation stage</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#fetch-stage">Fetch Stage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#architecture-and-modules">Architecture and Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#instr-realign">Instr_realign</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#instr-queue">Instr_queue</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#instr-scan">Instr_scan</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#bht-branch-history-table">BHT - Branch History Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#btb-branch-target-buffer">BTB - Branch Target Buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#ras-return-address-stack">RAS - Return Address Stack</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-decode">DECODE Sub-System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#functionality">Functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#architecture-and-modules">Architecture and Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#registers">Registers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-issue">ISSUE Sub-System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#functionality">Functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#architecture-and-modules">Architecture and Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#registers">Registers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-execute">EXECUTE Sub-System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#functionality">Functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#architecture-and-modules">Architecture and Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#registers">Registers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-commit">COMMIT Sub-System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#functionality">Functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#architecture-and-modules">Architecture and Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#registers">Registers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-controller">CONTROLLER Sub-System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#functionality">Functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#architecture-and-modules">Architecture and Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#registers">Registers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-caches">CACHES Sub-System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#functionality">Functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#architecture-and-modules">Architecture and Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#registers">Registers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-csrfile">CSRFILE Sub-System</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#functionality">Functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#architecture-and-modules">Architecture and Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#registers">Registers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-axi">AXI Protocol Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#functionality">Functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#architecture-and-modules">Architecture and Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#registers">Registers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-cvxif">CVXIF Protocol Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#functionality">Functionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#architecture-and-modules">Architecture and Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#registers">Registers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-glossary">Glossary</a></li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html#document-index">CORE-V CV32A6-step1 Design Specification</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html#document-index">Docs</a> &raquo;</li>
        
      <li>CORE-V CV32A6-step1 Design Specification  documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="openhw-group-cv32a6-step1-design-specification">
<h1>OpenHW Group CV32A6-step1 Design specification<a class="headerlink" href="#openhw-group-cv32a6-step1-design-specification" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<span id="document-intro"></span><div class="section" id="introduction">
<span id="intro"></span><h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>CVA6 is a 6-stage in-order and single issue processor core which implements
the RISC-V instruction set. Many features in the RISC-V specification are
optional, and CVA6 can be parameterized to enable or disable some of them.
CVA6 can be configured as a 32- or 64-bit core
(RV32 or RV64), called CV32A6 or CV64A6. The purpose of this document is
to describe the CV32A6 configuration which allows to connect coprocessor
through CV-X-IF but without Linux support, called CV32A6-step1.</p>
<p>The CVA6 architecture is illustrated in the following figure extracted from a paper written by F.Zaruba and L.Benini.</p>
<div class="figure align-center" id="cva6-architecute">
<img alt="" src="_images/ariane_overview.png" />
<p class="caption"><span class="caption-number">Figure 1 </span><span class="caption-text">CVA6 Architecture</span></p>
</div>
<div class="section" id="license">
<h3>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Copyright 2022 OpenHW Group and Thales</div>
<div class="line">Copyright 2018 ETH Zürich and University of Bologna</div>
<div class="line">SPDX-License-Identifier: Apache-2.0 WITH SHL-2.1</div>
<div class="line">Licensed under the Solderpad Hardware License v 2.1 (the “License”);
you may not use this file except in compliance with the License, or,
at your option, the Apache License version 2.0. You may obtain a copy
of the License at <a class="reference external" href="https://solderpad.org/licenses/SHL-2.1/">https://solderpad.org/licenses/SHL-2.1/</a>.</div>
<div class="line">Unless required by applicable law or agreed to in writing, any work
distributed under the License is distributed on an “AS IS” BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
implied. See the License for the specific language governing
permissions and limitations under the License.</div>
</div>
</div>
<div class="section" id="standards-compliance">
<h3>Standards Compliance<a class="headerlink" href="#standards-compliance" title="Permalink to this headline">¶</a></h3>
<p>To ease the reading, the reference to these specifications can be implicit in the requirements below. For the sake of precision, the requirements identify the versions of RISC-V extensions from these specifications.</p>
<ul class="simple">
<li><strong>[CVA6req]</strong> “CVA6 requirement specification”, <a class="reference external" href="https://github.com/openhwgroup/cva6/blob/master/docs/specifications/cva6_requirement_specification.rst">https://github.com/openhwgroup/cva6/blob/master/docs/specifications/cva6_requirement_specification.rst</a>, HASH#767c465.</li>
<li><strong>[RVunpriv]</strong> “The RISC-V Instruction Set Manual, Volume I: User-Level ISA, Document Version 20191213”, Editors Andrew Waterman and Krste Asanović, RISC-V Foundation, December 13, 2019.</li>
<li><strong>[RVpriv]</strong> “The RISC-V Instruction Set Manual, Volume II: Privileged Architecture, Document Version 20211203”, Editors Andrew Waterman, Krste Asanović and John Hauser, RISC-V Foundation, December 4, 2021.</li>
<li><strong>[RVdbg]</strong> “RISC-V External Debug Support, Document Version 0.13.2”, Editors Tim Newsome and Megan Wachs, RISC-V Foundation, March 22, 2019.</li>
<li><strong>[RVcompat]</strong> “RISC-V Architectural Compatibility Test Framework”, <a class="reference external" href="https://github.com/riscv-non-isa/riscv-arch-test">https://github.com/riscv-non-isa/riscv-arch-test</a>.</li>
<li><strong>[AXI]</strong> AXI Specification, <a class="reference external" href="https://developer.arm.com/documentation/ihi0022/hc">https://developer.arm.com/documentation/ihi0022/hc</a>.</li>
<li><strong>[CV-X-IF]</strong> Placeholder for the CV-X-IF coprocessor interface currently prepared at OpenHW Group; current version in <a class="reference external" href="https://docs.openhwgroup.org/projects/openhw-group-core-v-xif/">https://docs.openhwgroup.org/projects/openhw-group-core-v-xif/</a>.</li>
<li><strong>[OpenPiton]</strong> “OpenPiton Microarchitecture Specification”, Princeton University, <a class="reference external" href="https://parallel.princeton.edu/openpiton/docs/micro_arch.pdf">https://parallel.princeton.edu/openpiton/docs/micro_arch.pdf</a>.</li>
</ul>
<p>CV32A6-step1 is a standards-compliant 32-bit processor fully compliant with RISC-V specifications: [RVunpriv], [RVpriv] and [RVdbg] and passes [RVcompat] compatibility tests, as requested by [GEN-10] in
[CVA6req].</p>
</div>
<div class="section" id="documentation-framework">
<h3>Documentation framework<a class="headerlink" href="#documentation-framework" title="Permalink to this headline">¶</a></h3>
<p>The framework of this document is inspired by the Common Criteria. The Common Criteria for Information Technology Security Evaluation (referred to as Common Criteria or CC) is an international standard (ISO/IEC 15408) for computer security certification. The objective of this document is to provide enough information to allow the RTL modification (by designers) and the RTL verification (by verificators).</p>
<p>Description of the framework:</p>
<ul class="simple">
<li>Processor is split into subsystem corresponding to the main modules of the design</li>
<li>Subsystems can contain several modules</li>
<li>Each subsystem is described in a chapter, which contains the following subchapters: “Description”, “Functionalities”, “Architecture and Modules” and “Registers” (if any)</li>
<li>The subchapter “Description” describes the main features of the submodule, the interconnections between the current subsystem and the others and the inputs/outputs interface.</li>
<li>The subchapter “Functionality” lists in details the subsystem functionalities. Please avoid using the RTL signal names to explain the functionalities.</li>
<li>The subchapter “Architecture and Modules” provides a drawing to present the module hierarchy, then the functionalities covered by the module</li>
<li>The subchapter “Registers” specifies the subsystem registers if any</li>
</ul>
</div>
<div class="section" id="contributors">
<h3>Contributors<a class="headerlink" href="#contributors" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">Jean-Roch Coulon
(<a class="reference external" href="mailto:jean-roch&#46;coulon&#37;&#52;&#48;thalesgroup&#46;com">jean-roch<span>&#46;</span>coulon<span>&#64;</span>thalesgroup<span>&#46;</span>com</a>)</div>
</div>
<p>[TO BE COMPLETED]</p>
</div>
</div>
<span id="document-system"></span><div class="section" id="cv32a6-step1-system">
<span id="system"></span><h2>CV32A6-step1 System<a class="headerlink" href="#cv32a6-step1-system" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description">
<h3>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h3>
<p>The CV32A6-step1 is a system composed of the subsystems and protocol interfaces as illustrated in the figure. The processor is a Harvard-based modern architecture. Instructions are issued in-order through the DECODE stage and executed out-of-order but committed in-order. The processor is Single issue, that means that at maximum one instruction per cycle can be issued to the EXECUTE stage.</p>
<p>The CV32A6-step1 implements a 6-stage pipeline composed of PC Generation, Instruction Detch, Instruction Decode, Issue stage, Execute stage and Commit stage. At least 6 cycles are needed to execute one instruction.</p>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-number">Table 1 </span><span class="caption-text">cv32a6-step1 interface signals</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Signal</th>
<th class="head">IO</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">clk_i</span></code></td>
<td>in</td>
<td>logic</td>
<td>system clock</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">rst_ni</span></code></td>
<td>in</td>
<td>logic</td>
<td>Asynchronous reset active low</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">boot_addr_i</span></code></td>
<td>in</td>
<td>logic[VLEN-1:0]</td>
<td>Reset boot address</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">hart_id_i</span></code></td>
<td>in</td>
<td>logic[XLEN-1:0]</td>
<td>Hart id in a multicore environment (reflected in a CSR)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">irq_i</span></code></td>
<td>in</td>
<td>logic[1:0]</td>
<td>Level sensitive IR lines, mip &amp; sip (async)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ipi_i</span></code></td>
<td>in</td>
<td>logic</td>
<td>Inter-processor interrupts (async)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">time_irq_i</span></code></td>
<td>in</td>
<td>logic</td>
<td>Timer interrupt in (async)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">debug_req_i</span></code></td>
<td>in</td>
<td>logic</td>
<td>Debug request (async)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">rvfi_o</span></code></td>
<td>out</td>
<td>trace_port_t</td>
<td>RISC-V Formal Interface port (RVFI)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">cvxif_req_o</span></code></td>
<td>out</td>
<td>cvxif_req_t</td>
<td>Coprocessor Interface request interface port (CV-X-IF)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">cvxif_resp_i</span></code></td>
<td>in</td>
<td>cvxif_resp_t</td>
<td>Coprocessor Interface response interface port (CV-X-IF)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">axi_req_o</span></code></td>
<td>out</td>
<td>req_t</td>
<td>AXI master request interface port</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">axi_resp_i</span></code></td>
<td>in</td>
<td>resp_t</td>
<td>AXI master response interface port</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="functionality">
<h3>Functionality<a class="headerlink" href="#functionality" title="Permalink to this headline">¶</a></h3>
<p>CV32A6-step1 implements a configuration which allows to connect coprocessor to it through CV-X-IF coprocessor interface, but the lack of MMU and A extension prevent from executing Linux.</p>
<table border="1" class="docutils" id="id2">
<caption><span class="caption-number">Table 2 </span><span class="caption-text">CV32A6-step1 Configuration</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Standard Extension</th>
<th class="head">Specification</th>
<th class="head">Configurability</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>I</strong>: RV32i Base Integer Instruction Set</td>
<td>[RVunpriv]</td>
<td>enabled</td>
</tr>
<tr class="row-odd"><td><strong>C</strong>: Standard Extension for Compressed Instructions</td>
<td>[RVunpriv]</td>
<td>enabled</td>
</tr>
<tr class="row-even"><td><strong>M</strong>: Standard Extension for Integer Multiplication and Division</td>
<td>[RVunpriv]</td>
<td>enabled</td>
</tr>
<tr class="row-odd"><td><strong>A</strong>: Standard Extension for Atomic transaction</td>
<td>[RVunpriv]</td>
<td>disabled</td>
</tr>
<tr class="row-even"><td><strong>F and D</strong>: Single and Double Precision Floating-Point</td>
<td>[RVunpriv]</td>
<td>disabled</td>
</tr>
<tr class="row-odd"><td><strong>Zicount</strong>: Performance Counters</td>
<td>[RVunpriv]</td>
<td>disabled</td>
</tr>
<tr class="row-even"><td><strong>Zicsr</strong>: Control and Status Register Instructions</td>
<td>[RVpriv]</td>
<td>enabled</td>
</tr>
<tr class="row-odd"><td><strong>Zifencei</strong>: Instruction-Fetch Fence</td>
<td>[RVunpriv]</td>
<td>enabled</td>
</tr>
<tr class="row-even"><td><strong>Privilege</strong>: Standard privilege modes M, S and U</td>
<td>[RVpriv]</td>
<td>enabled</td>
</tr>
<tr class="row-odd"><td><strong>SV39, SV32, SV0</strong>: MMU capability</td>
<td>[RVpriv]</td>
<td>disabled</td>
</tr>
<tr class="row-even"><td><strong>PMP</strong>: Memory Protection Unit</td>
<td>[RVpriv]</td>
<td>disabled</td>
</tr>
<tr class="row-odd"><td><strong>CSR</strong>: Control and Status Registers</td>
<td>[RVpriv]</td>
<td>enabled</td>
</tr>
<tr class="row-even"><td><strong>I$</strong>: Instruction cache micro-architecture</td>
<td>current spec</td>
<td>enabled</td>
</tr>
<tr class="row-odd"><td><strong>D$</strong>: Data cache micro-architecture</td>
<td>current spec</td>
<td>disabled</td>
</tr>
<tr class="row-even"><td><strong>Rename</strong>: register Renaming micro-architecture to increase perf</td>
<td>current spec</td>
<td>disabled</td>
</tr>
<tr class="row-odd"><td><strong>Double Commit</strong>: pipeline micro-architecture</td>
<td>current spec</td>
<td>enabled</td>
</tr>
<tr class="row-even"><td><strong>BP</strong>: Branch Prediction micro-architecture</td>
<td>current spec</td>
<td>enabled but without information storage</td>
</tr>
<tr class="row-odd"><td><strong>AXI</strong>: AXI interface</td>
<td>[CV-X-IF]</td>
<td>enabled</td>
</tr>
<tr class="row-even"><td><strong>TRI</strong>: Translation Response Interface (TRI)</td>
<td>[OpenPiton]</td>
<td>disabled</td>
</tr>
</tbody>
</table>
<p>CVA6 memory interface complies with AXI5 specification including the Atomic_Transactions property support as defined in [AXI] section E1.1.</p>
<p>CVA6 coprocessor interface complies with CV-X-IF protocol specification as defined in [CV-X-IF].</p>
<p>The CV32A4-step1 core is fully synthesizable. It has been designed mainly for ASIC designs, but FPGA synthesis is supported as well.</p>
<p>For ASIC synthesis, the whole design is completely synchronous and uses positive-edge triggered flip-flops. The core occupies an area of about 80 kGE. The clock frequency can be more than 1GHz depending of technology.</p>
</div>
<div class="section" id="architecture">
<h3>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="cva6-system">
<img alt="" src="_images/CVA6_subsystems.png" />
<p class="caption"><span class="caption-number">Figure 2 </span><span class="caption-text">CV32A6-step1 System</span></p>
</div>
</div>
</div>
<span id="document-frontend"></span><div class="section" id="frontend-sub-system">
<span id="frontend"></span><h2>FRONTEND Sub-System<a class="headerlink" href="#frontend-sub-system" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description">
<h3>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h3>
<p>The FRONTEND sub-system implements two first stages of the cva6 pipeline, PC gen and Fetch stages.</p>
<p>PC gen stage is responsible for generating the next program counter hosting a Branch Target Buffer (BTB) a Branch History Table (BHT) and a Return Address Stack (RAS) to speculate on the branch target address.</p>
<p>Fetch stage requests data to the CACHE sub-system, realigns the data to store them in instruction queue and transmits the instructions to the
DECODE sub-system. FRONTEND can fetch up to 2 instructions per cycles when C extension instructions is used, but as instruction queue limits
the data rate, up to one instruction per cycle can be sent to DECODE.</p>
<p>The system is connected to:</p>
<ul class="simple">
<li>CACHES Sub-System provides fethed instructions to FRONTEND.</li>
<li>DECODE Sub-System receives instructions from FRONTEND.</li>
<li>CONTROLLER Sub-System can order FRONTEND to flush PC gen stage</li>
<li>EXECUTE, CONTROLLER, CSR and COMMIT Sub-systems triggers PC jumping due to a branch mispredict, an exception, a return from exception, a debug entry or pipeline flush. They provides related PC next value.</li>
<li>CSR Sub-system states about debug mode.</li>
</ul>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-number">Table 3 </span><span class="caption-text">FRONTEND interface signals</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Signal</th>
<th class="head">IO</th>
<th class="head">connection</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">clk_i</span></code></td>
<td>in</td>
<td>SYSTEM</td>
<td>logic</td>
<td>System Clock</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">rst_ni</span></code></td>
<td>in</td>
<td>SYSTEM</td>
<td>logic</td>
<td>Asynchronous reset active low</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">debug_mode_i</span></code></td>
<td>in</td>
<td>CSR</td>
<td>logic</td>
<td>Debug mode state</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">flush_i</span></code></td>
<td>in</td>
<td>CONTROLLER</td>
<td>logic</td>
<td>Fetch flush request</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">flush_bp_i</span></code></td>
<td>in</td>
<td>stuck at zero</td>
<td>logic</td>
<td>flush branch prediction</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">boot_addr_i</span></code></td>
<td>in</td>
<td>SYSTEM</td>
<td>logic[VLEN-1:0]</td>
<td>Next PC when reset</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">resolved_branch_i</span></code></td>
<td>in</td>
<td>EXECUTE</td>
<td>bp_resolve_t</td>
<td>mispredict event and next PC</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">eret_i</span></code></td>
<td>in</td>
<td>CSR</td>
<td>logic</td>
<td>Return from exception event</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">epc_i</span></code></td>
<td>in</td>
<td>CSR</td>
<td>logic[VLEN-1:0]</td>
<td>Next PC when returning from exception</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ex_valid_i</span></code></td>
<td>in</td>
<td>COMMIT</td>
<td>logic</td>
<td>Exception event</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">trap_vector_base_i</span></code></td>
<td>in</td>
<td>CSR</td>
<td>logic[VLEN-1:0]</td>
<td>Next PC when jumping into exception</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">set_pc_commit_i</span></code></td>
<td>in</td>
<td>CONTROLLER</td>
<td>logic</td>
<td>Set the PC coming from COMMIT as next PC</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">pc_commit_i</span></code></td>
<td>in</td>
<td>COMMIT</td>
<td>logic[VLEN-1:0]</td>
<td>Next PC when flushing pipeline</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">set_debug_pc_i</span></code></td>
<td>in</td>
<td>CSR</td>
<td>logic</td>
<td>Debug event</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">icache_dreq_o</span></code></td>
<td>out</td>
<td>CACHES</td>
<td>icache_dreq_i_t</td>
<td>Handshake between CACHE and FRONTEND (fetch)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">icache_dreq_i</span></code></td>
<td>in</td>
<td>CACHES</td>
<td>icache_dreq_o_t</td>
<td>Handshake between CACHE and FRONTEND (fetch)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">fetch_entry_o</span></code></td>
<td>out</td>
<td>DECODE</td>
<td>fetch_entry_t</td>
<td>Handshake’s data between FRONTEND (fetch) and DECODE</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">fetch_entry_valid_o</span></code></td>
<td>out</td>
<td>DECODE</td>
<td>logic</td>
<td>Handshake’s valid between FRONTEND (fetch) and DECODE</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">fetch_entry_ready_i</span></code></td>
<td>in</td>
<td>DECODE</td>
<td>logic</td>
<td>Handshake’s ready between FRONTEND (fetch) and DECODE</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="functionality">
<h3>Functionality<a class="headerlink" href="#functionality" title="Permalink to this headline">¶</a></h3>
<div class="section" id="pc-generation-stage">
<h4>PC Generation stage<a class="headerlink" href="#pc-generation-stage" title="Permalink to this headline">¶</a></h4>
<p>PC gen generates the next program counter. The next PC can originate from the following sources (listed in order of precedence):</p>
<ul class="simple">
<li><strong>Reset state:</strong> At reset, the PC is assigned to the boot address.</li>
<li><strong>Branch Predict:</strong> Fetched instruction is predecoded thanks to instr_scan module. When instruction is a control flow that for a return instruction, the RAS contains a valid address, three cases need to be considered. 1) Instruction is a JALR and BTB (Branch Target Buffer) speculates a PC jump 2) Instruction is a branch and BTH (Branch History table) speculates a PC jump 3) Instruction is a RET and RAS (Return Address Stack) speculates the target address. In these three cases, PC Gen sets the next PC to the predicted address and also informs the Fetch stage that it performed a prediction on the PC. In CV32A6-step1, Branch Prediction is simplified: BHT, BTB and RSA do not store any information.</li>
<li><strong>Default:</strong> PC + 4 is fetched. PC Gen always fetches on a word boundary (32-bit). Compressed instructions are handled by fetch stage.</li>
<li><strong>Mispredict:</strong> When a branch prediction is mispredicted, the EXECUTE feedbacks a misprediction. This can either be a ‘real’ mis-prediction or a branch which was not recognized as one. In any case we need to correct our action and start fetching from the correct address.</li>
<li><strong>Replay instruction fetch:</strong> When the instruction queue is full, the instr_queue module asks the fetch replay and provides the address to be replayed.</li>
<li><strong>Return from environment call:</strong> When CSR asks a return from an environment call, the PC is assigned to the successive PC to the one stored in the CSR [m-s]epc register.</li>
<li><strong>Exception/Interrupt:</strong> If an exception (or interrupt, which is in the context of RISC-V systems quite similar) is triggered by the COMMIT, the next PC Gen is assigned to the CSR trap vector base address. The trap vector base address can be different depending on whether the exception traps to S-Mode or M-Mode (user mode exceptions are currently not supported). It is the purpose of the CSR Unit to figure out where to trap to and present the correct address to PC Gen.</li>
<li><strong>Pipeline Flush:</strong> When a CSR with side-effects gets written the whole pipeline is flushed by CONTROLLER and FRONTEND starts fetching from the next instruction again in order to take the up-dated information into account (for example virtual memory base pointer changes). The PC related to the flush action is provided by the COMMIT. Moreover flush is also transmitted to the CACHES through the next fetch CACHES access and instruction queue is reset.</li>
<li><strong>Debug:</strong> Debug has the highest order of precedence as it can interrupt any control flow requests. It also the only source of control flow change which can actually happen simultaneously to any other of the forced control flow changes. The debug jump is requested by CSR. The address to be jumped into is HW coded. This debug feature is not supported by  cv32a6-step1.</li>
</ul>
<p>All program counters are logical addressed. If the logical to physical mapping changes a fence.vm instruction should used to flush the pipeline and TLBs.</p>
</div>
<div class="section" id="fetch-stage">
<h4>Fetch Stage<a class="headerlink" href="#fetch-stage" title="Permalink to this headline">¶</a></h4>
<p>Fetch stage controls by handshake protocol the CACHE sub-system. Fetched data are 32-bit block with word aligned address. A granted fetch is realigned into instr_realign module to produce instructions. Then instructions are pushed into an internal instruction FIFO called instruction queue (instr_queue module). This module stores the instructions and related information which allow to identify the outstanding transactions. In the case CONTROLLER decides to flush the instruction queue, the outstanding transactions are discarded.</p>
<p>The Fetch stage asks the MMU to translate the requested address.</p>
<p>Memory and MMU can feedback potential exceptions generated by the memory fetch request. They can be bus errors, invalid accesses or instruction page faults.</p>
</div>
</div>
<div class="section" id="architecture-and-modules">
<h3>Architecture and Modules<a class="headerlink" href="#architecture-and-modules" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="frontend-modules">
<img alt="" src="_images/frontend_modules.png" />
<p class="caption"><span class="caption-number">Figure 3 </span><span class="caption-text">FRONTEND modules</span></p>
</div>
<div class="section" id="instr-realign">
<h4>Instr_realign<a class="headerlink" href="#instr-realign" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils" id="id2">
<caption><span class="caption-number">Table 4 </span><span class="caption-text">instr_realign interface signals</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Signal</th>
<th class="head">IO</th>
<th class="head">connection</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">clk_i</span></code></td>
<td>in</td>
<td>SYSTEM</td>
<td>logic</td>
<td>System Clock</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">rst_ni</span></code></td>
<td>in</td>
<td>SYSTEM</td>
<td>logic</td>
<td>Asynchronous reset active low</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">flush_i</span></code></td>
<td>in</td>
<td>combinatory</td>
<td>logic</td>
<td>Instr_align Flush</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">valid_i</span></code></td>
<td>in</td>
<td>CACHES (reg)</td>
<td>logic</td>
<td>32-bit block is valid</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">address_i</span></code></td>
<td>in</td>
<td>CACHES (reg)</td>
<td>logic[VLEN-1:0]</td>
<td>32-bit block address</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">data_i</span></code></td>
<td>in</td>
<td>CACHES (reg)</td>
<td>logic[31:0]</td>
<td>32-bit block</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">valid_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic[1:0]</td>
<td>instruction is valid</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">addr_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic[1:0][VLEN-1:0]</td>
<td>Instruction address</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">instr_o</span></code></td>
<td>out</td>
<td>instr_scan, instr_queue</td>
<td>logic[1:0][31:0]</td>
<td>Instruction</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">serving_unaligned_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic</td>
<td>Instruction is unaligned</td>
</tr>
</tbody>
</table>
<p>The 32-bit aligned block coming from the CACHE sub-system enters the instr_realign module. This module extracts the instructions from the 32-bit blocks, up to two instructions because it is possible to fetch two instructions when C extension is used. If the instructions are not compressed, it is possible that the instruction is not aligned on the block size but rather interleaved with two cache blocks. In that case, two cache accesses are needed. The instr_realign module provides at maximum one instruction per cycle. Not complete instruction is stored in instr_realign module before being provided in the next cycles.</p>
<p>In case of mispredict, flush, replay or branch predict, the instr_realign is re-initialized, the internal register storing the instruction alignment state is reset.</p>
</div>
<div class="section" id="instr-queue">
<h4>Instr_queue<a class="headerlink" href="#instr-queue" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils" id="id3">
<caption><span class="caption-number">Table 5 </span><span class="caption-text">instr_realign interface signals</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Signal</th>
<th class="head">IO</th>
<th class="head">connection</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">clk_i</span></code></td>
<td>in</td>
<td>SYSTEM</td>
<td>logic</td>
<td>System Clock</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">rst_ni</span></code></td>
<td>in</td>
<td>SYSTEM</td>
<td>logic</td>
<td>Asynchronous reset active low</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">flush_i</span></code></td>
<td>in</td>
<td>CONTROLLER</td>
<td>logic</td>
<td>Fetch flush request</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">valid_i</span></code></td>
<td>in</td>
<td>instr_realign</td>
<td>logic[1:0]</td>
<td>Instruction is valid</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">instr_i</span></code></td>
<td>in</td>
<td>instr_realign</td>
<td>logic[1:0][31:0]</td>
<td>Instruction</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">addr_i</span></code></td>
<td>in</td>
<td>instr_realign</td>
<td>logic[1:0][VLEN-1:0]</td>
<td>Instruction address</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">predict_address_i</span></code></td>
<td>in</td>
<td>combinatory</td>
<td>logic[VLEN-1:0]</td>
<td>Instruction predict address</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">cf_type_i</span></code></td>
<td>in</td>
<td>combinatory</td>
<td>logic[1:0]</td>
<td>Instruction control flow type</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ready_o</span></code></td>
<td>out</td>
<td>CACHES</td>
<td>logic</td>
<td>Handshake’s ready between CACHE and FRONTEND (fetch stage)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">consumed_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic[1:0]</td>
<td>Indicates instructions consummed, that is to say popped by DECODE</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">exception_i</span></code></td>
<td>in</td>
<td>CACHES (reg)</td>
<td>logic</td>
<td>Exception</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">exception_addr_i</span></code></td>
<td>in</td>
<td>CACHES (reg)</td>
<td>logic[VLEN-1:0]</td>
<td>Exception address</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">replay_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic</td>
<td>Replay instruction because one of the FIFO was already full</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">replay_addr_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic[VLEN-1:0]</td>
<td>Address at which to replay the fetch</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">fetch_entry_o</span></code></td>
<td>out</td>
<td>DECODE</td>
<td>fetch_entry_t</td>
<td>Handshake’s data between FRONTEND (fetch stage) and DECODE</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">fetch_entry_valid_o</span></code></td>
<td>out</td>
<td>DECODE</td>
<td>logic</td>
<td>Handshake’s valid between FRONTEND (fetch stage) and DECODE</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">fetch_entry_ready_i</span></code></td>
<td>in</td>
<td>DECODE</td>
<td>logic</td>
<td>Handshake’s ready between FRONTEND (fetch stage) and DECODE</td>
</tr>
</tbody>
</table>
<p>The instr_queue receives 32bit block from CACHES to create a valid stream of instructions to be decoded (by DECODE), to be issued (by ISSUE) and executed (by EXECUTE). FRONTEND pushes in FIFO to store the instructions and related information needed in case of mispredict or exception: instructions, instruction control flow type, exception, exception address and preicted address. DECODE pops them when decode stage is ready and indicates to the FRONTEND the instruction has been consummed.</p>
<p>In instruction queue, exception can only correspond to page-fault exception.</p>
<p>If the instruction queue is full, a replay request is sent to inform the fetch mechanism to replay the fetch.</p>
<p>The instruction queue can be flushed.</p>
</div>
<div class="section" id="instr-scan">
<h4>Instr_scan<a class="headerlink" href="#instr-scan" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils" id="id4">
<caption><span class="caption-number">Table 6 </span><span class="caption-text">instr_scan interface signals</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Signal</th>
<th class="head">IO</th>
<th class="head">Connection</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">instr_i</span></code></td>
<td>in</td>
<td>instr_realign</td>
<td>logic[31:0]</td>
<td>Instruction to be predecoded</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">rvi_return_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic</td>
<td>Return instruction</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">rvi_call_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic</td>
<td>JAL instruction</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">rvi_branch_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic</td>
<td>Branch instruction</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">rvi_jalr_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic</td>
<td>JALR instruction</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">rvi_jump_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic</td>
<td>unconditional jump instruction</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">rvi_imm_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic[VLEN-1:0]</td>
<td>Instruction immediat</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">rvc_branch_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic</td>
<td>Branch compressed instruction</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">rvc_jump_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic</td>
<td>unconditional jump compressed instruction</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">rvc_jr_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic</td>
<td>JR compressed instruction</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">rvc_return_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic</td>
<td>Return compressed instruction</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">rvc_jalr_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic</td>
<td>JALR compressed instruction</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">rvc_call_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic</td>
<td>JAL compressed instruction</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">rvc_imm_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>logic[VLEN-1:0]</td>
<td>Instruction compressed immediat</td>
</tr>
</tbody>
</table>
<p>The instr_scan module pre-decodes the fetched instructions, instructions could be compressed or not. The outputs are used by the branch prediction feature. The instr_scan module tells if the instruction is compressed and provides the intruction type: branch, jump, return, jalr, imm, call or others.</p>
</div>
<div class="section" id="bht-branch-history-table">
<h4>BHT - Branch History Table<a class="headerlink" href="#bht-branch-history-table" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils" id="id5">
<caption><span class="caption-number">Table 7 </span><span class="caption-text">BHT interface signals</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Signal</th>
<th class="head">IO</th>
<th class="head">Connection</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">clk_i</span></code></td>
<td>in</td>
<td>SYSTEM</td>
<td>logic</td>
<td>System clock</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">rst_ni</span></code></td>
<td>in</td>
<td>SYSTEM</td>
<td>logic</td>
<td>Asynchronous reset active low</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">flush_i</span></code></td>
<td>in</td>
<td>stuck at zero</td>
<td>logic</td>
<td>Flush request</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">debug_mode_i</span></code></td>
<td>in</td>
<td>CSR</td>
<td>logic</td>
<td>Debug mode state</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">vpc_i</span></code></td>
<td>in</td>
<td>CACHES (reg)</td>
<td>logic[VLEN-1:0]</td>
<td>Virtual PC</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">bht_update_i</span></code></td>
<td>in</td>
<td>EXECUTE</td>
<td>bht_update_t</td>
<td>Update btb with resolved address</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">bht_prediction_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>bht_prediction_t</td>
<td>Prediction from bht</td>
</tr>
</tbody>
</table>
<p>When a branch instruction is resolved by the EXECUTE, the relative information is stored in the Branch History Table.</p>
<p>The Branch History table is a two-bit saturation counter that takes the virtual address of the current fetched instruction by the CACHE. It states whether the current branch request should be taken or not. The two bit counter is updated by the successive execution of the current instructions as shown in the following figure. The BHT is not updated if processor is in debug mode.</p>
<div class="figure align-center" id="bht-saturation">
<img alt="" src="_images/bht.png" />
<p class="caption"><span class="caption-number">Figure 4 </span><span class="caption-text">BHT saturation</span></p>
</div>
<p>When a branch instruction is pre-decoded by instr_scan module, the BHT informs whether the PC address is in the BHT. In this case, the BHT predicts whether the branch is taken and provides the corresponding target address.</p>
<p>The BTB is never flushed.</p>
</div>
<div class="section" id="btb-branch-target-buffer">
<h4>BTB - Branch Target Buffer<a class="headerlink" href="#btb-branch-target-buffer" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils" id="id6">
<caption><span class="caption-number">Table 8 </span><span class="caption-text">BTB interface signals</span><a class="headerlink" href="#id6" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Signal</th>
<th class="head">IO</th>
<th class="head">Connection</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">clk_i</span></code></td>
<td>in</td>
<td>SYSTEM</td>
<td>logic</td>
<td>System clock</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">rst_ni</span></code></td>
<td>in</td>
<td>SYSTEM</td>
<td>logic</td>
<td>Asynchronous reset active low</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">flush_i</span></code></td>
<td>in</td>
<td>stuck at zero</td>
<td>logic</td>
<td>Flush request state</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">debug_mode_i</span></code></td>
<td>in</td>
<td>CSR</td>
<td>logic</td>
<td>Debug mode</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">vpc_i</span></code></td>
<td>in</td>
<td>CACHES (reg)</td>
<td>logic</td>
<td>Virtual PC</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">btb_update_i</span></code></td>
<td>in</td>
<td>EXECUTE</td>
<td>btb_update_t</td>
<td>Update BTB with resolved address</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">btb_prediction_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>btb_prediction_t</td>
<td>BTB Prediction</td>
</tr>
</tbody>
</table>
<p>When a unconditional jumps to a register (JALR instruction) is mispredicted by the EXECUTE, the relative information is stored into the BTB, that is to say the JALR PC and the target address. The BTB is not updated if processor is in debug mode.</p>
<p>When a branch instruction is pre-decoded by instr_scan module, the BTB informs whether the input PC address is in BTB. In this case, the BTB provides the corresponding target address.</p>
<p>The BTB is never flushed.</p>
</div>
<div class="section" id="ras-return-address-stack">
<h4>RAS - Return Address Stack<a class="headerlink" href="#ras-return-address-stack" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils" id="id7">
<caption><span class="caption-number">Table 9 </span><span class="caption-text">RAS interface signals</span><a class="headerlink" href="#id7" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Signal</th>
<th class="head">IO</th>
<th class="head">Connection</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">clk_i</span></code></td>
<td>in</td>
<td>SYSTEM</td>
<td>logic</td>
<td>System clock</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">rst_ni</span></code></td>
<td>in</td>
<td>SYSTEM</td>
<td>logic</td>
<td>Asynchronous reset active low</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">flush_i</span></code></td>
<td>in</td>
<td>Stuck at zero</td>
<td>logic</td>
<td>Flush request</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">push_i</span></code></td>
<td>in</td>
<td>combinatory</td>
<td>logic</td>
<td>Push address in RAS</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">pop_i</span></code></td>
<td>in</td>
<td>combinatory</td>
<td>logic</td>
<td>Pop address from RAS</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">data_i</span></code></td>
<td>in</td>
<td>combinatory</td>
<td>logic[VLEN-1:0]</td>
<td>Data to be pushed</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">data_o</span></code></td>
<td>out</td>
<td>combinatory</td>
<td>ras_t</td>
<td>Popped data</td>
</tr>
</tbody>
</table>
<p>When an unconditional jumps to a known target address (JAL instruction) is consummed by the instr_queue, the next pc after the JAL instruction and the return address are stored into the RAS.</p>
<p>When a branch instruction is pre-decoded by instr_scan module, the RAS informs whether the input PC address is in RAS. In this case, the RAS provides the corresponding target address.</p>
<p>The RAS is never flushed.</p>
</div>
</div>
</div>
<span id="document-decode"></span><div class="section" id="decode-sub-system">
<span id="decode"></span><h2>DECODE Sub-System<a class="headerlink" href="#decode-sub-system" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description">
<h3>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h3>
<p>CV32A6-step1 decodes the following instructions coming fron the FRONTEND sub-system to send the information to the ISSUE sub-system:
* As requested by [ISA-20] of [CVA6req], RV32I base instruction set, version 2.1
* As requested by [ISA-30] of [CVA6req], M extension (integer multiply and divide), version 2.0
* As requested by [ISA-80] of [CVA6req], C extension (compressed instructions), version 2.0
* As requested by [ISA-90] of [CVA6req], Zicsr extension (CSR instructions), version 2.0
* As requested by [ISA-100] of [CVA6req], Zifencei extension, version 2.0</p>
</div>
<div class="section" id="functionality">
<h3>Functionality<a class="headerlink" href="#functionality" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="architecture-and-modules">
<h3>Architecture and Modules<a class="headerlink" href="#architecture-and-modules" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="registers">
<h3>Registers<a class="headerlink" href="#registers" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<span id="document-issue"></span><div class="section" id="issue-sub-system">
<span id="issue"></span><h2>ISSUE Sub-System<a class="headerlink" href="#issue-sub-system" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description">
<h3>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="functionality">
<h3>Functionality<a class="headerlink" href="#functionality" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="architecture-and-modules">
<h3>Architecture and Modules<a class="headerlink" href="#architecture-and-modules" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="registers">
<h3>Registers<a class="headerlink" href="#registers" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<span id="document-execute"></span><div class="section" id="execute-sub-system">
<span id="execute"></span><h2>EXECUTE Sub-System<a class="headerlink" href="#execute-sub-system" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description">
<h3>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="functionality">
<h3>Functionality<a class="headerlink" href="#functionality" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="architecture-and-modules">
<h3>Architecture and Modules<a class="headerlink" href="#architecture-and-modules" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="registers">
<h3>Registers<a class="headerlink" href="#registers" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<span id="document-commit"></span><div class="section" id="commit-sub-system">
<span id="commit"></span><h2>COMMIT Sub-System<a class="headerlink" href="#commit-sub-system" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description">
<h3>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="functionality">
<h3>Functionality<a class="headerlink" href="#functionality" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="architecture-and-modules">
<h3>Architecture and Modules<a class="headerlink" href="#architecture-and-modules" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="registers">
<h3>Registers<a class="headerlink" href="#registers" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<span id="document-controller"></span><div class="section" id="controller-sub-system">
<span id="controller"></span><h2>CONTROLLER Sub-System<a class="headerlink" href="#controller-sub-system" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description">
<h3>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="functionality">
<h3>Functionality<a class="headerlink" href="#functionality" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="architecture-and-modules">
<h3>Architecture and Modules<a class="headerlink" href="#architecture-and-modules" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="registers">
<h3>Registers<a class="headerlink" href="#registers" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<span id="document-caches"></span><div class="section" id="caches-sub-system">
<span id="caches"></span><h2>CACHES Sub-System<a class="headerlink" href="#caches-sub-system" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description">
<h3>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="functionality">
<h3>Functionality<a class="headerlink" href="#functionality" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="architecture-and-modules">
<h3>Architecture and Modules<a class="headerlink" href="#architecture-and-modules" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="registers">
<h3>Registers<a class="headerlink" href="#registers" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<span id="document-csrfile"></span><div class="section" id="csrfile-sub-system">
<span id="csrfile"></span><h2>CSRFILE Sub-System<a class="headerlink" href="#csrfile-sub-system" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description">
<h3>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="functionality">
<h3>Functionality<a class="headerlink" href="#functionality" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="architecture-and-modules">
<h3>Architecture and Modules<a class="headerlink" href="#architecture-and-modules" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="registers">
<h3>Registers<a class="headerlink" href="#registers" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<span id="document-axi"></span><div class="section" id="axi-protocol-interface">
<span id="axi"></span><h2>AXI Protocol Interface<a class="headerlink" href="#axi-protocol-interface" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description">
<h3>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="functionality">
<h3>Functionality<a class="headerlink" href="#functionality" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="architecture-and-modules">
<h3>Architecture and Modules<a class="headerlink" href="#architecture-and-modules" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="registers">
<h3>Registers<a class="headerlink" href="#registers" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<span id="document-cvxif"></span><div class="section" id="cvxif-protocol-interface">
<span id="cvxif"></span><h2>CVXIF Protocol Interface<a class="headerlink" href="#cvxif-protocol-interface" title="Permalink to this headline">¶</a></h2>
<div class="section" id="description">
<h3>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="functionality">
<h3>Functionality<a class="headerlink" href="#functionality" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="architecture-and-modules">
<h3>Architecture and Modules<a class="headerlink" href="#architecture-and-modules" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="registers">
<h3>Registers<a class="headerlink" href="#registers" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<span id="document-glossary"></span><div class="section" id="glossary">
<span id="id1"></span><h2>Glossary<a class="headerlink" href="#glossary" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>VLEN</strong>: Virtual address lengh</li>
<li><strong>XLEN</strong>: RISC-V processor data lengh</li>
<li><strong>ALU</strong>: Arithmetic/Logic Unit</li>
<li><strong>ASIC</strong>: Application-Specific Integrated Circuit</li>
<li><strong>Byte</strong>: 8-bit data item</li>
<li><strong>CPU</strong>: Central Processing Unit, processor</li>
<li><strong>CSR</strong>: Control and Status Register</li>
<li><strong>Custom extension</strong>: Non-Standard extension to the RISC-V base instruction set (RISC-V Instruction Set Manual, Volume I: User-Level ISA)</li>
<li><strong>EXE</strong>: Instruction Execute</li>
<li><strong>FPGA</strong>: Field Programmable Gate Array</li>
<li><strong>FPU</strong>: Floating Point Unit</li>
<li><strong>Halfword</strong>: 16-bit data item</li>
<li><strong>Halfword aligned address</strong>: An address is halfword aligned if it is divisible by 2</li>
<li><strong>ID</strong>: Instruction Decode</li>
<li><strong>IF</strong>: Instruction Fetch</li>
<li><strong>ISA</strong>: Instruction Set Architecture</li>
<li><strong>KGE</strong>: kilo gate equivalents (NAND2)</li>
<li><strong>LSU</strong>: Load Store Unit</li>
<li><strong>M-Mode</strong>: Machine Mode (RISC-V Instruction Set Manual, Volume II: Privileged Architecture)</li>
<li><strong>OBI</strong>: Open Bus Interface</li>
<li><strong>PC</strong>: Program Counter</li>
<li><strong>PULP platform</strong>: Parallel Ultra Low Power Platform (&lt;<a class="reference external" href="https://pulp-platform.org">https://pulp-platform.org</a>&gt;)</li>
<li><strong>RV32C</strong>: RISC-V Compressed (C extension)</li>
<li><strong>RV32F</strong>: RISC-V Floating Point (F extension)</li>
<li><strong>SIMD</strong>: Single Instruction/Multiple Data</li>
<li><strong>Standard extension</strong>: Standard extension to the RISC-V base instruction set (RISC-V Instruction Set Manual, Volume I: User-Level ISA)</li>
<li><strong>WARL</strong>: Write Any Values, Reads Legal Values</li>
<li><strong>WB</strong>: Write Back of instruction results</li>
<li><strong>WLRL</strong>: Write/Read Only Legal Values</li>
<li><strong>Word</strong>: 32-bit data item</li>
<li><strong>Word aligned address</strong>: An address is word aligned if it is divisible by 4</li>
<li><strong>WPRI</strong>: Reserved Writes Preserve Values, Reads Ignore Values</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, OpenHW Group

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>